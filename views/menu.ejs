<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu principal</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/preloader.css">
    <link rel="icon" type="image/png" href="/img/icon.png">
    <style>
        /* Animação para os card aparecer suavemente */
        @keyframes aparecer {
          0% {
            transform: scale(0);
            opacity: 0;
          }
          100% {
            transform: scale(1);
            opacity: 1;
          }
        }

        .animar-criacao {
          animation: aparecer 1s ease-in-out;
        }

        body,html{
          height: 100%;
        }

        .popup {
          position: fixed;
          top: 20px;
          right: 20px;
          background-color: #4CAF50; /* Verde */
          color: white;
          padding: 15px;
          border-radius: 5px;
          transition: opacity 0.5s ease;
        }

        .card-body{
          background-color: #FFFFF0;
        }

    </style>
</head>
<body style="display: none; background-image: url(/img/dot.webp);" class="d-flex flex-column">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid px-5 d-flex align-items-center">
        <div class="d-flex align-items-center">
            <a class="navbar-brand" href="#!">
                <img class="img-fluid" src="/img/logo.png" style="width: 300px;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto m-2 mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link active borda" aria-current="page" href="#!">Home</a></li>
                <li class="nav-item"><a class="nav-link borda" href="#!">About</a></li>
                <li class="nav-item"><a class="nav-link borda" href="#!">Contact</a></li>
                <li class="nav-item"><a class="nav-link borda bordadown" href="#!">Services</a></li>
            </ul>
        </div>
    </div>
</nav>

<main class="container flex-grow-1 my-4">
  <div class="container">
    <div id="objetoContainer" class="row justify-content-center">  
        <div class="col-md-5 mb-4 produto">
            <div class="card animar-criacao text-center">
              <div class="card-body">
                  <h4 class="card-title"> Editar perfil</h4>
                  <p class="card-text">Clique aqui para editar seu nome, email ou senha</p>
                  <button class="btn btn-warning atualizar">Editar</button>
              </div>
              <div class="card-body">
                  <h4 class="card-title"> Fazer logout</h4>
                  <p class="card-text">Clique para sair da sua conta</p>
                  <button class="btn btn-info atualizar">Sair</button>
              </div>
            </div>
        </div>
        <div class="col-md-6 mb-4 produto">
            <div class="card animar-criacao text-center">
                <div class="card-body">
                    <h4 class="card-title"> Criar estoque Post-It ou Planilha</h4>
                    <p class="card-text">Clique para gerar um novo estoque para produtos</p>
                    <form>
                        <label class="form-label" for="nome">Nome do estoque</label>
                        <input class="form-control" type="text" name="nome" id="">
                    </form>
                    <button class="btn btn-primary atualizar">Post-It</button>
                    <button class="btn btn-success atualizar">Planilha</button>
                </div>
            </div>
        </div>
        <% if (cards) { %>
          <% cards.forEach(function(nome){ %>
            <div class="col-md-5 mb-4 produto">
            <div class="card animar-criacao text-center">
              <div class="card-body">
                  <h4 class="card-title"> <%= nome %> </h4>
                  <p class="card-text">Acesse seu estoque aqui</p>
                  <button class="btn btn-warning atualizar">Entrar</button>
              </div>
            </div>
            </div>
        <% })}; %>
    </div>
  </div>
</main>


<footer class="py-4 bg-dark">
    <div class="container px-5"><p class="m-0 text-center text-white">Copyright &copy; EverythingAtOnce 2024</p></div>
</footer>
<script src="/js/bootstrap.bundle.js"></script>
<script src="/js/popper.min.js"></script>
<script>


document.getElementById('cardCreator').addEventListener('click', () => {
    const popup = document.getElementById('popup');
    popup.style.display = 'block'; // Mostra o popup

    // Esconde o popup após 3 segundos
    setTimeout(() => {
        popup.style.opacity = '0'; // Anima a opacidade
        setTimeout(() => {
            popup.style.display = 'none'; // Remove do DOM após a animação
            popup.style.opacity = '1'; // Reseta a opacidade para a próxima vez
        }, 500); // Espera o tempo da animação
    }, 3000); // Tempo que o popup ficará visível
});

const preloader = document.querySelector('#carregamento');
if (preloader) {
  window.addEventListener('DOMContentLoaded', () => {
    preloader.remove();
    atualizar();
  });
}

document.getElementById ('cardCreator').addEventListener('submit', function(event) {
    event.preventDefault();

    const formData = new FormData(event.target);
    const titulo = formData.get('nameProduct');
    const categoria = formData.get('categoryProduct');
    const criadoEm = new Date().toLocaleDateString();

    const response = fetch('/api/appendCard',{
      method: 'Post',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        titulo, quantidade, validade,
        preco,categoria,fornecedor,criadoEm
      })
    });

    console.log(response.ok);

    // Cria o elemento a ser animado
    const card = document.createElement('div');
    card.classList.add('col-md', 'mb-4', 'produto'); // Adiciona classe para coluna e margem
    card.innerHTML = `
      <div class="card animar-criacao">
        <div class="card-body">
          <h4 class="card-title">${titulo}</h4>
          <h6 class="card-title my-3">Qtd: ${quantidade}</h6>
          <h6 class="card-title my-3">R$: ${preco}</h6>
          <h6 class="card-title mb-3">Categoria: ${categoria}</h6>
          <h6 class="card-title mb-3">Validade: ${validade}</h6>
          <h6 class="card-title my-3">Fornecedor: ${fornecedor}</h6>
          <h6 class="card-title mb-4">Criado em: ${criadoEm}</h6>
          <div class="d-flex align-contents-center">
            <button class="btn btn-info atualizar mx-4">Atualizar</button>
            <button class="btn btn-danger deletar">Apagar</button>
          </div>
        </div>
      </div>
    `;
    
    // Adiciona o card ao container
    document.getElementById('objetoContainer').appendChild(card);
    
    // Atualizar os eventListener de deletar
    atualizar();
  });

function validateNumber(input) {
  // Remove todos os caracteres que não sejam números
  input.value = input.value.replace(/\D/g, '');
}

function atualizar(){
  const botoes = document.querySelectorAll('.deletar');
  botoes.forEach(function(botao) {
      botao.addEventListener('click', function() {
        // Subir na hierarquia até encontrar o card mais próximo
        const card = botao.closest('.produto');
        // Remove o card correspondente
        card.remove();
      });
  });
}

</script>
</body>
</html>