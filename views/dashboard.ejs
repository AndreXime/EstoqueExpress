<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EverythingAtOnce - Dashboard</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/preloader.css">
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
    <style>
        /* Animação para os card aparecer suavemente */
        @keyframes aparecer {
          0% {
            transform: scale(0);
            opacity: 0;
          }
          100% {
            transform: scale(1);
            opacity: 1;
          }
        }

        .animar-criacao {
          animation: aparecer 1s ease-in-out;
        }

        body,html{
          height: 100%;
        }
    </style>
</head>
<body style="display: none;" class="d-flex flex-column">
<div id="carregamento"></div>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid px-5 d-flex align-items-center">
        <div class="d-flex align-items-center">
            <a class="navbar-brand" href="#!">
                <img class="img-fluid" src="/img/logo.png" style="width: 300px;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto m-2 mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link active borda" aria-current="page" href="#!">Home</a></li>
                <li class="nav-item"><a class="nav-link borda" href="#!">About</a></li>
                <li class="nav-item"><a class="nav-link borda" href="#!">Contact</a></li>
                <li class="nav-item"><a class="nav-link borda bordadown" href="#!">Services</a></li>
            </ul>
        </div>
    </div>
</nav>

<main class="container flex-grow-1 main-content">
  <div class="container mt-5">
    <div class="row mt-3">
      <div class="col-md mb-4">
          <div class="card animar-criacao">
              <div class="card-body">
                <form id="cardCreator">
                  <div class="row">
                    <div class="mb-3 col-md-4">
                      <label for="nameProduct" class="form-label">Nome do produto</label>
                      <input id="nameProduct" class="form-control" type="text" name="nameProduct">
                    </div>
                    <div class="mb-3 col-md-4">
                      <label for="priceProduct" class="form-label">Preço do produto</label>
                      <input id="priceProduct" class="form-control" type="text" name="priceProduct">
                    </div>
                    <div class="mb-3 col-md-4">
                      <label for="categoryProduct" class="form-label">Categoria do produto</label>
                      <input id="categoryProduct" class="form-control" type="text" name="categoryProduct">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-4 mb-3">
                      <label for="qtdProduct" class="form-label">Quantidade do produto</label>
                      <input class="form-control" type="number" name="qtdProduct" id="qtdProduct" oninput="validateNumber(this)">
                    </div>
                    <div class="col-md-4 mb-3">
                      <label for="dateProduct" class="form-label">Vencimento do produto</label>
                      <input class="form-control" type="date" name="dateProduct" id="dateProduct">
                    </div>
                    <div class="col-md-4 mb-3">
                      <label for="fornecedorProduct" class="form-label">Fornecedor do produto</label>
                      <input id="fornecedorProduct" class="form-control" type="text" name="fornecedorProduct">
                    </div>
                  </div>
                  <input class="btn btn-primary" id="criarObjeto" type="submit" value="Criar objeto">
                </form>
              </div>
          </div>
      </div>
    </div>
    <div id="objetoContainer" class="row mt-2">
      <% cards.forEach(card => { %>
        <div class="col-md mb-4 produto">
          <div class="card animar-criacao">
            <div class="card-body">
              <h4 class="card-title"><%= card.titulo %></h4>
              <h6 class="card-title my-3">Qtd: <%= card.quantidade %></h6>
              <h6 class="card-title my-3">R$: <%= card.preco %></h6>
              <h6 class="card-title mb-3">Categoria: <%= card.categoria %></h6>
              <h6 class="card-title mb-3">Validade: <%= card.validade %></h6>
              <h6 class="card-title my-3">Fornecedor: <%= card.fornecedor %></h6>
              <h6 class="card-title mb-4">Criado em: <%= card.criadoEm %></h6>
              <div class="d-flex align-contents-center">
                <button class="btn btn-info atualizar mx-4">Atualizar</button>
                <button class="btn btn-danger deletar">Apagar</button>
              </div>
            </div>
          </div>
        </div>
      <% });%>   
    </div>
  </div>
</main>

<footer class="py-4 bg-dark border-top">
    <div class="container px-5"><p class="m-0 text-center text-white">Copyright &copy; EverythingAtOnce 2024</p></div>
</footer>
<script src="/js/bootstrap.bundle.js"></script>
<script src="/js/popper.min.js"></script>
<script>
const preloader = document.querySelector('#carregamento');
  if (preloader) {
    window.addEventListener('DOMContentLoaded', () => {
      preloader.remove();
      atualizar();
    });
  }

document.getElementById ('cardCreator').addEventListener('submit', function(event) {
    event.preventDefault();

    const formData = new FormData(event.target);
    const titulo = formData.get('nameProduct');
    const quantidade = formData.get('qtdProduct');
    const validade = formData.get('dateProduct');
    const preco = formData.get('priceProduct');
    const categoria = formData.get('categoryProduct');
    const fornecedor = formData.get('fornecedorProduct');
    const criadoEm = new Date().toLocaleDateString();

    const response = fetch('/api/appendCard',{
      method: 'Post',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        titulo, quantidade, validade,
        preco,categoria,fornecedor,criadoEm
      })
    });

    console.log(response.ok);

    // Cria o elemento a ser animado
    const card = document.createElement('div');
    card.classList.add('col-md', 'mb-4', 'produto'); // Adiciona classe para coluna e margem
    card.innerHTML = `
      <div class="card animar-criacao">
        <div class="card-body">
          <h4 class="card-title">${titulo}</h4>
          <h6 class="card-title my-3">Qtd: ${quantidade}</h6>
          <h6 class="card-title my-3">R$: ${preco}</h6>
          <h6 class="card-title mb-3">Categoria: ${categoria}</h6>
          <h6 class="card-title mb-3">Validade: ${validade}</h6>
          <h6 class="card-title my-3">Fornecedor: ${fornecedor}</h6>
          <h6 class="card-title mb-4">Criado em: ${criadoEm}</h6>
          <div class="d-flex align-contents-center">
            <button class="btn btn-info atualizar mx-4">Atualizar</button>
            <button class="btn btn-danger deletar">Apagar</button>
          </div>
        </div>
      </div>
    `;
    
    // Adiciona o card ao container
    document.getElementById('objetoContainer').appendChild(card);
    
    // Atualizar os eventListener de deletar
    atualizar();
  });

  function validateNumber(input) {
    // Remove todos os caracteres que não sejam números
    input.value = input.value.replace(/\D/g, '');
  }

  function atualizar(){
    const botoes = document.querySelectorAll('.deletar');
    botoes.forEach(function(botao) {
        botao.addEventListener('click', function() {
          // Subir na hierarquia até encontrar o card mais próximo
          const card = botao.closest('.produto');
          // Remove o card correspondente
          card.remove();
        });
    });
  }

</script>
</body>
</html>